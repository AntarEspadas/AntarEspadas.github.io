import{b as be,m as ye,c as ae,g as J,e as Ve,a as le,V as Ce}from"./helpers.23a0596b.js";import{n as G,e as Se,a as we,b as ke,c as _e,d as Ae,f as Pe}from"./index.858a4a56.js";import{i as xe,L as Te,j as ie,k as te,h as Fe}from"./VLabel.1475aadc.js";import{h as re,i as Ie,j as ue,k as H,l as De,n as Be,o as Re,f as ze,a as Ue,b as E,c as x,d as M,e as ne,g as Ee}from"./VSpacer.b3fd4ada.js";import{a as se,v as Le,x as Oe,e as W,y as k,z as oe,r as g,w as Z,A as ce,h as a,i as j,F as Q,B as Ne,C as $e,D as je,j as Ke,o as N,k as Ge,l as u,u as q,c as $,E as Y,q as Me,G as qe}from"./entry.638dfdac.js";import{u as de}from"./ssrBoot.b02e0988.js";const Xe=se()({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...re({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>Le(e).every(f=>f!=null&&typeof f=="object")},...Ie({clearable:!0})},emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,f){let{attrs:s,emit:c,slots:o}=f;const{t:i}=Oe(),l=W(e,"modelValue"),{isFocused:h,focus:m,blur:V}=ue(e),_=k(()=>typeof e.showSize!="boolean"?e.showSize:void 0),p=k(()=>(l.value??[]).reduce((n,d)=>{let{size:P=0}=d;return n+P},0)),T=k(()=>oe(p.value,_.value)),A=k(()=>(l.value??[]).map(n=>{const{name:d="",size:P=0}=n;return e.showSize?`${d} (${oe(P,_.value)})`:d})),R=k(()=>{var d;const n=((d=l.value)==null?void 0:d.length)??0;return e.showSize?i(e.counterSizeString,n,T.value):i(e.counterString,n)}),F=g(),z=g(),C=g();function S(){var n;C.value!==document.activeElement&&((n=C.value)==null||n.focus()),h.value||m()}function K(n){L(n)}function I(n){c("mousedown:control",n)}function L(n){var d;(d=C.value)==null||d.click(),c("click:control",n)}function D(n){n.stopPropagation(),S(),Ne(()=>{l.value=[],$e(e["onClick:clear"],n)})}return Z(l,n=>{(!Array.isArray(n)||!n.length)&&C.value&&(C.value.value="")}),de(()=>{const n=!!(o.counter||e.counter),d=!!(n||o.details),[P,v]=ce(s),[{modelValue:r,...t}]=H.filterProps(e),[w]=De(e);return a(H,j({ref:F,modelValue:l.value,"onUpdate:modelValue":b=>l.value=b,class:["v-file-input",e.class],style:e.style,"onClick:prepend":K},P,t,{focused:h.value}),{...o,default:b=>{let{id:y,isDisabled:O,isDirty:B,isReadonly:ve,isValid:fe}=b;return a(Be,j({ref:z,"prepend-icon":e.prependIcon,onMousedown:I,onClick:L,"onClick:clear":D,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},w,{id:y.value,active:B.value||h.value,dirty:B.value,disabled:O.value,focused:h.value,error:fe.value===!1}),{...o,default:me=>{var ee;let{props:{class:pe,...ge}}=me;return a(Q,null,[a("input",j({ref:C,type:"file",readonly:ve.value,disabled:O.value,multiple:e.multiple,name:e.name,onClick:U=>{U.stopPropagation(),S()},onChange:U=>{if(!U.target)return;const he=U.target;l.value=[...he.files??[]]},onFocus:S,onBlur:V},ge,v),null),a("div",{class:pe},[!!((ee=l.value)!=null&&ee.length)&&(o.selection?o.selection({fileNames:A.value,totalBytes:p.value,totalBytesReadable:T.value}):e.chips?A.value.map(U=>a(be,{key:U,size:"small",color:e.color},{default:()=>[U]})):A.value.join(", "))])])}})},details:d?b=>{var y,O;return a(Q,null,[(y=o.details)==null?void 0:y.call(o,b),n&&a(Q,null,[a("span",null,null),a(Re,{active:!!((O=l.value)!=null&&O.length),value:R.value},o.counter)])])}:void 0})}),ze({},F,z,C)}});const Je=se()({name:"VSwitch",inheritAttrs:!1,props:{indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...re(),...ye()},emits:{"update:focused":e=>!0,"update:modelValue":()=>!0,"update:indeterminate":e=>!0},setup(e,f){let{attrs:s,slots:c}=f;const o=W(e,"indeterminate"),i=W(e,"modelValue"),{loaderClasses:l}=xe(e),{isFocused:h,focus:m,blur:V}=ue(e),_=k(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),p=je(),T=k(()=>e.id||`switch-${p}`);function A(){o.value&&(o.value=!1)}return de(()=>{const[R,F]=ce(s),[z,C]=H.filterProps(e),[S,K]=ae.filterProps(e),I=g();function L(D){var n,d;D.stopPropagation(),D.preventDefault(),(d=(n=I.value)==null?void 0:n.input)==null||d.click()}return a(H,j({class:["v-switch",{"v-switch--inset":e.inset},{"v-switch--indeterminate":o.value},l.value,e.class],style:e.style},R,z,{id:T.value,focused:h.value}),{...c,default:D=>{let{id:n,messagesId:d,isDisabled:P,isReadonly:v,isValid:r}=D;return a(ae,j({ref:I},S,{modelValue:i.value,"onUpdate:modelValue":[t=>i.value=t,A],id:n.value,"aria-describedby":d.value,type:"checkbox","aria-checked":o.value?"mixed":void 0,disabled:P.value,readonly:v.value,onFocus:m,onBlur:V},F),{...c,default:()=>a("div",{class:"v-switch__track",onClick:L},null),input:t=>{let{textColorClasses:w,textColorStyles:b}=t;return a("div",{class:["v-switch__thumb",w.value],style:b.value},[e.loading&&a(Te,{name:"v-switch",active:!0,color:r.value===!1?void 0:_.value},{default:y=>c.loader?c.loader(y):a(ie,{active:y.isActive,color:y.color,indeterminate:!0,size:"16",width:"2"},null)})])}})}})}),{}}});class He{pipelineAgaLic(f,s,c,o,i,l){return this.pipelineAga(f,s,c,o,"aga-lic",i,l)}pipelineAgaPos(f,s,c,o,i,l){return this.pipelineAga(f,s,c,o,"aga-pos",i,l)}async pipelineKardex(f,s,c,o){const i=new FormData;if(i.append("tabla",f),i.append("runner",c),i.append("ubicacionTemporal",o),s===void 0)throw new Error("No se han seleccionado archivos");for(let l=0;l<s.length;l++)i.append("archivos",s[l]);return fetch("/api/pipelines/kardex",{body:i,method:"POST",headers:await J()})}async pipelineCursos(f,s,c,o){const i=new FormData;if(i.append("tabla",f),i.append("runner",c),i.append("ubicacionTemporal",o),s===void 0)throw new Error("No se han seleccionado archivos");for(let l=0;l<s.length;l++)i.append("archivos",s[l]);return fetch("/api/pipelines/cursos",{body:i,method:"POST",headers:await J()})}async pipelineAga(f,s,c,o,i,l,h){const m=new FormData;if(m.append("trimestre",f),m.append("semana",s),m.append("tabla",c),m.append("runner",l),m.append("ubicacionTemporal",h),o===void 0)throw new Error("No se han seleccionado archivos");for(let V=0;V<o.length;V++)m.append("archivos",o[V]);return fetch(`/api/pipelines/${i}`,{body:m,method:"POST",headers:await J()})}}const X=new He,Qe={class:"contenedor-formulario"},Ye=Ke({__name:"index",setup(e){const f="DataflowRunner",s="gs://almacenamiento-aga/tmp",c=new Date,o=c.getFullYear().toString().slice(2),i=Ve(c),l=g("LIC"),h=g(!1),m=g([]),V=g(o+i),_=g("4"),p=g("inicio"),T=g(""),A=g(f),R=g(s),F=g(),z=g(),C=k(()=>{const v="proyecto-aga.Aga.";return l.value==="LIC"?v+"Licenciatura":l.value==="POS"?v+"Posgrado":l.value==="KARDEX"?v+"Kardex":v+"Cursos"}),S=g(C.value);Z(C,(v,r)=>{S.value===r&&(S.value=v)}),Z(p,()=>{var v;(p.value==="éxito"||p.value==="error")&&((v=z.value)==null||v.reset())});async function K(v){if(v.preventDefault(),F.value===void 0)return;const{valid:r}=await F.value.validate();if(!r)return;let t,w,b;h.value?(t=S.value,w=A.value,b=R.value):(t=C.value,w=f,b=s);let y;l.value==="LIC"?y=X.pipelineAgaLic(V.value,_.value,t,m.value,w,b):l.value==="POS"?y=X.pipelineAgaPos(V.value,_.value,t,m.value,w,b):l.value==="KARDEX"?y=X.pipelineKardex(t,m.value,w,b):y=X.pipelineCursos(t,m.value,w,b),p.value="cargando";const B=await(await y).json();if(console.log(B),B.idPedido===void 0){console.error(B),p.value="error",T.value=JSON.stringify(B.error);return}I(B.idPedido)}async function I(v){const r=`/api/pipelines/status?idPedido=${v}`;fetch(r,{headers:await J()}).then(t=>t.json()).then(t=>{console.log(t),t.terminado===!1?setTimeout(()=>I(v),500):t.error?(p.value="error",T.value=JSON.stringify(t.error)):p.value="éxito"}).catch(t=>{console.error(t),setTimeout(()=>I(v),500)})}const L=[G,ke],D=[G,Se,we(1,12)],n=k(()=>h.value?[G,_e]:[]),d=[Ae],P=k(()=>h.value?[G,Pe]:[]);return(v,r)=>(N(),Ge("div",Qe,[a(q(Ee),{ref_key:"refForm",ref:F,"validate-on":"blur",onSubmit:K},{default:u(()=>[a(Ue,null,{default:u(()=>[a(E,null,{default:u(()=>[a(x,null,{default:u(()=>[a(le,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=t=>l.value=t),variant:"outlined",label:"Tipo de archivo",items:[{title:"AGA Licenciatura",value:"LIC"},{title:"AGA Posgrado",value:"POS"},{title:"Kardex",value:"KARDEX"},{title:"Cursos",value:"CURSOS"}]},null,8,["modelValue"])]),_:1})]),_:1}),a(E,null,{default:u(()=>[a(x,null,{default:u(()=>[a(q(Xe),{ref_key:"refSelectorArchivos",ref:z,modelValue:m.value,"onUpdate:modelValue":r[1]||(r[1]=t=>m.value=t),multiple:"",counter:"","show-size":"",chips:"",label:"Seleccionar archivos",variant:"outlined",rules:d},null,8,["modelValue"])]),_:1})]),_:1}),a(te,null,{default:u(()=>[l.value==="LIC"||l.value==="POS"?(N(),$(E,{key:0},{default:u(()=>[a(x,{cols:"12",sm:"6"},{default:u(()=>[a(M,{modelValue:V.value,"onUpdate:modelValue":r[2]||(r[2]=t=>V.value=t),variant:"outlined",label:"Trimestre",hint:"Trimestre al que corresponde el archivo. ej: 18I, 22O, etc.",rules:L},null,8,["modelValue"])]),_:1}),a(x,{cols:"12",sm:"6"},{default:u(()=>[a(M,{modelValue:_.value,"onUpdate:modelValue":r[3]||(r[3]=t=>_.value=t),variant:"outlined",label:"Semana",hint:"Semana a la que corresponde el archivo. (Entre 1 y 12)",rules:D},null,8,["modelValue"])]),_:1})]),_:1})):Y("",!0)]),_:1}),a(E,{dense:""},{default:u(()=>[a(x,null,{default:u(()=>[a(Je,{modelValue:h.value,"onUpdate:modelValue":r[4]||(r[4]=t=>h.value=t),label:"Opciones avanzadas"},null,8,["modelValue"])]),_:1})]),_:1}),a(te,null,{default:u(()=>[h.value?(N(),$(E,{key:0},{default:u(()=>[a(x,{cols:"12",sm:"6"},{default:u(()=>[a(M,{modelValue:S.value,"onUpdate:modelValue":r[5]||(r[5]=t=>S.value=t),variant:"outlined",label:"Tabla",hint:"Tabla destino de BigQuery, en el formato proyecto.conjunto-de-datos.tabla",rules:q(n)},null,8,["modelValue","rules"])]),_:1}),a(x,{cols:"12",sm:"6"},{default:u(()=>[a(le,{modelValue:A.value,"onUpdate:modelValue":r[6]||(r[6]=t=>A.value=t),label:"Runner",variant:"outlined",items:["DataflowRunner","DirectRunner"]},null,8,["modelValue"])]),_:1}),a(x,{cols:"12",sm:"6"},{default:u(()=>[a(M,{modelValue:R.value,"onUpdate:modelValue":r[7]||(r[7]=t=>R.value=t),variant:"outlined",label:"Ubicación temporal",hint:"Ubicación temporal de los archivos en GCS. ej: gs://bucket/temp",rules:q(P)},null,8,["modelValue","rules"])]),_:1})]),_:1})):Y("",!0)]),_:1}),a(E,null,{default:u(()=>[a(ne),p.value!=="cargando"?(N(),$(Fe,{key:0,type:"submit"},{default:u(()=>[Me("Subir archivos")]),_:1})):(N(),$(ie,{key:1,color:"primary",indeterminate:""})),a(ne)]),_:1}),a(E,null,{default:u(()=>[a(x,null,{default:u(()=>[p.value==="error"||p.value==="éxito"?(N(),$(Ce,{key:0,text:p.value==="error"?T.value:"El archivo se subió correctamente",density:"compact",type:p.value==="éxito"?"success":"error",variant:"tonal",closable:""},null,8,["text","type"])):Y("",!0)]),_:1})]),_:1})]),_:1})]),_:1},512)]))}});const na=qe(Ye,[["__scopeId","data-v-efa91d3b"]]);export{na as default};
